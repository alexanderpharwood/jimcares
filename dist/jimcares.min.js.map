{"version":3,"file":"jimcares.min.js","sources":["../src/helpers/driver.js","../src/helpers/getPathProps.js","../src/api/getValue.js","../src/api/size.js","../src/helpers/sizeof.js","../src/api/getRoot.js","../src/helpers/setUpdatedAt.js","../src/api/trash.js","../src/api/toJson.js","../src/api/forget.js","../src/helpers/dateFromDifferenceString.js","../src/helpers/dateAdd.js","../src/api/initialise.js","../src/Jim.js","../src/api/has.js","../src/api/remember.js","../src/api/writeToLS.js","../src/api/clear.js","../src/api/destroy.js","../src/api/count.js","../src/api/equals.js"],"sourcesContent":["function driver(){\n\tif (typeof window.__jimcares === 'undefined') {\n\t\tthrow new Error('Jim is not initialised yet. Call Jim.init({options}) first');\n\t}\n\n\treturn window.__jimcares;\n}\n\nexport default driver;\n","function getPathProps(path) {\n\treturn path.split('/');\n}\n\nexport default getPathProps;\n","import driver from '../helpers/driver.js';\nimport getPathProps from '../helpers/getPathProps.js';\n\nfunction getValue(path) {\n\tlet memory = driver();\n\tlet pathProps = getPathProps(path);\n\n\tif (pathProps.length === 0) {\n\t\treturn memory.roots[path].value;\n\t}\n\n\tif (typeof memory.roots[pathProps[0]] === 'undefined') {\n\t\treturn undefined;\n\t}\n\n\tvar node = memory.roots[pathProps[0]].value;\n\tpathProps.shift();\n\tfor (let index in pathProps) {\n\t\tnode = node[pathProps[index]];\n\t}\n\n\treturn node;\n}\n\nexport default getValue;\n","import driver from '../helpers/driver.js';\nimport sizeof from '../helpers/sizeof.js';\n\nfunction size(path) {\n\treturn sizeof(driver().roots);\n}\n\nexport default size;\n","/*\n\nsizeof.js\n\nA function to calculate the approximate memory usage of objects\n\nCreated by Kate Morley - http://code.iamkate.com/ - and released under the terms\nof the CC0 1.0 Universal legal code:\n\nhttp://creativecommons.org/publicdomain/zero/1.0/legalcode\n\n*/\n\n/* Returns the approximate memory usage, in bytes, of the specified object. The\n * parameter is:\n *\n * object - the object whose size should be determined\n */\nfunction sizeof(object){\n\n  // initialise the list of objects and size\n  var objects = [object];\n  var size    = 0;\n\n  // loop over the objects\n  for (var index = 0; index < objects.length; index ++){\n\n\t// determine the type of the object\n\tswitch (typeof objects[index]){\n\n\t  // the object is a boolean\n\t  case 'boolean': size += 4; break;\n\n\t  // the object is a number\n\t  case 'number': size += 8; break;\n\n\t  // the object is a string\n\t  case 'string': size += 2 * objects[index].length; break;\n\n\t  // the object is a generic object\n\t  case 'object':\n\n\t\t// if the object is not an array, add the sizes of the keys\n\t\tif (Object.prototype.toString.call(objects[index]) != '[object Array]'){\n\t\t  for (var key in objects[index]) size += 2 * key.length;\n\t\t}\n\n\t\t// loop over the keys\n\t\tfor (var key in objects[index]){\n\n\t\t  // determine whether the value has already been processed\n\t\t  var processed = false;\n\t\t  for (var search = 0; search < objects.length; search ++){\n\t\t\tif (objects[search] === objects[index][key]){\n\t\t\t  processed = true;\n\t\t\t  break;\n\t\t\t}\n\t\t  }\n\n\t\t  // queue the value to be processed if appropriate\n\t\t  if (!processed) objects.push(objects[index][key]);\n\n\t\t}\n\n\t}\n\n  }\n\n  // return the calculated size\n  return size;\n\n}\n\nexport default sizeof;\n","import driver from '../helpers/driver.js';\nimport getPathProps from '../helpers/getPathProps.js';\n\nfunction getRoot(path) {\n\tlet memory = driver();\n\tlet pathProps = getPathProps(path);\n\n\tif (pathProps.length === 0) {\n\t\treturn memory.roots[path].value;\n\t}\n\n\treturn memory.roots[pathProps[0]];\n}\n\nexport default getRoot;\n","import driver from '../helpers/driver.js';\n\nfunction setUpdatedAt() {\n\tdriver().updated_at = new Date();\n}\n\nexport default setUpdatedAt;\n","import getRoot from './getRoot.js';\nimport setUpdatedAt from '../helpers/setUpdatedAt.js';\n\nfunction trash(path) {\n\tlet root = getRoot(path);\n\tif (typeof root === 'undefined') {\n\t\treturn false;\n\t}\n\troot.deleted_at = new Date();\n\tsetUpdatedAt();\n\treturn true;\n}\n\nexport default trash;\n","import driver from '../helpers/driver.js';\n\nfunction toJson(path) {\n\treturn JSON.stringify(driver());\n}\n\nexport default toJson;\n","import driver from '../helpers/driver.js';\nimport getPathProps from '../helpers/getPathProps.js';\nimport setUpdatedAt from '../helpers/setUpdatedAt.js';\n\nfunction forget(path) {\n\tlet memory = driver();\n\tlet pathProps = getPathProps(path);\n\tsetUpdatedAt();\n\treturn delete memory.roots[path];\n}\n\nexport default forget;\n","import dateAdd from './dateAdd.js';\n\nfunction dateFromDifferenceString(difference) {\n\tvar date = new Date();\n\tvar interval = difference.split(' ')[1];\n\tvar units = difference.split(' ')[0];\n\tdate = dateAdd(date, interval, units);\n\treturn date;\n}\n\nexport default dateFromDifferenceString;\n","/**\n * Adds time to a date. Modelled after MySQL DATE_ADD function.\n * Example: dateAdd(new Date(), 'minute', 30)  //returns 30 minutes from now.\n * https://stackoverflow.com/a/1214753/18511\n *\n * @param date  Date to start with\n * @param interval  One of: year, month, week, day, hour, minute, second\n * @param units  Number of units of the given interval to add.\n */\nfunction dateAdd(date, interval, units) {\n\tvar ret = new Date(date); //don't change original date\n\tvar checkRollover = function() {\n\t\tif (ret.getDate() !== date.getDate()) {\n\t\t\tret.setDate(0);\n\t\t}\n\t}\n\n\tswitch(interval.toLowerCase()) {\n\t\tcase 'year':\n\t\tcase 'years':\n\t\t\tret.setFullYear(ret.getFullYear() + units);\n\t\t\tcheckRollover();\n\t\t\tbreak;\n\t\tcase 'month':\n\t\tcase 'months':\n\t\t\tret.setMonth(ret.getMonth() + units);\n\t\t\tcheckRollover();\n\t\t\tbreak;\n\t\tcase 'week':\n\t\tcase 'weeks':\n\t\t\tret.setDate(ret.getDate() + 7*units);\n\t\t\tbreak;\n\t\tcase 'day':\n\t\tcase 'days':\n\t\t\tret.setDate(ret.getDate() + units);\n\t\t\tbreak;\n\t\tcase 'hour':\n\t\tcase 'hours':\n\t\t\tret.setTime(ret.getTime() + units*3600000);\n\t\t\tbreak;\n\t\tcase 'minute':\n\t\tcase 'minutes':\n\t\t\tret.setTime(ret.getTime() + units*60000);\n\t\t\tbreak;\n\t\tcase 'second':\n\t\tcase 'seconds':\n\t\t\tret.setTime(ret.getTime() + units*1000);\n\t\t\tbreak;\n\t\tdefault       :\n\t\t\tret = undefined;\n\t\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nexport default dateAdd;\n","import dateAdd from '../helpers/dateAdd.js';\nimport driver from '../helpers/driver.js';\nimport forget from '../api/forget.js';\nimport getRoot from '../api/getRoot.js';\n\n\n/**\n * Initialise Jimcares\n *\n * @param object settings\n * @return bool\n */\nfunction init(settings) {\n\n\t//Default settings\n\tlet defaultExpiration = '24 hours';\n\n\tif (typeof settings !== 'undefined') {\n\t\tif (typeof settings.defaultExpiration !== 'undefined') {\n\t\t\tlet defaultExpiration = settings.defaultExpiration;\n\t\t}\n\t}\n\n\twindow.__jimcares = {\n\t\tcreated_at: new Date(),\n\t\tupdated_at: new Date(),\n\t\troots: {},\n\t\tdefaultExpiration: defaultExpiration,\n\t};\n\n\tlet expirationWorker = function(){\n\t\treturn setInterval(function(){\n\t\t\tfor (let i in window.__jimcares.roots) {\n\t\t\t\tif (getRoot(i).expires_at.getTime() < (new Date()).getTime()) {\n\t\t\t\t \tforget(i);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 5000)\n\t};\n\n\twindow.__jimcares.expirationWorker = expirationWorker();\n\n\treturn true;\n}\n\nexport default init;\n","import has from './api/has.js';\nimport size from './api/size.js';\nimport trash from './api/trash.js';\nimport clear from './api/clear.js';\nimport count from './api/count.js';\nimport equals from './api/equals.js';\nimport toJson from './api/toJson.js';\nimport forget from './api/forget.js';\nimport getRoot from './api/getRoot.js';\nimport destroy from './api/destroy.js';\nimport getValue from './api/getValue.js';\nimport remember from './api/remember.js';\nimport writeToLS from './api/writeToLS.js';\nimport initialise from './api/initialise.js';\n\nclass Jim {\n\n\tstatic init() {\n\t\treturn initialise();\n\t}\n\n\t/**\n\t * Determine whether jim has the given path.\n\t *\n\t * @param string path\n\t * @return bool\n\t */\n\tstatic has(path) {\n\t\treturn has(path);\n\t}\n\n\t/**\n\t * Save a value at the given path.\n\t *\n\t * @param string path\n\t * @param mixed value\n\t * @return bool\n\t */\n\tstatic remember(path, value, expires_at) {\n\t\treturn remember(path, value, expires_at);\n\t}\n\n\t/**\n\t * Get the value from the given path.\n\t *\n\t * @param string path\n\t * @return mixed\n\t */\n\tstatic get(path) {\n\t\treturn getValue(path);\n\t}\n\n\t/**\n\t * Get the root from the given path.\n\t *\n\t * @param string path\n\t * @return object\n\t */\n\tstatic root(path) {\n\t\treturn getRoot(path);\n\t}\n\n\t/**\n\t * Write the cache to local storage.\n\t *\n\t * @todo optional path to store only a singe root.\n\t * @return bool\n\t */\n\tstatic writeToLS() {\n\t\treturn writeToLS();\n\t}\n\n\t/**\n\t * Soft delete the root at the given root.\n\t *\n\t * @param string path\n\t * @return bool\n\t */\n\tstatic trash(path) {\n\t\treturn trash(path);\n\t}\n\n\t/**\n\t * Check if the given path has been soft deleted.\n\t *\n\t * @param string path\n\t * @return bool\n\t */\n\tstatic isTrashed(path) {\n\t\treturn trash(path);\n\t}\n\n\t/**\n\t * Hard delete the root at the given path.\n\t *\n\t * @param string path\n\t * @return bool\n\t */\n\tstatic forget(path) {\n\t\treturn forget(path);\n\t}\n\n\t/**\n\t * Clear all roots from the cache.\n\t *\n\t * @return void\n\t */\n\tstatic clear() {\n\t\tclear()\n\t}\n\n\t/**\n\t * Destroy the entire cache.\n\t *\n\t * @return void\n\t */\n\tstatic destroy() {\n\t\tdestroy();\n\t}\n\n\t/**\n\t * Export the entire cache to json, or the given path.\n\t *\n\t * @todo optional parameter to return the json string for a given path.\n\t * @return string\n\t */\n\tstatic toJson() {\n\t\treturn toJson();\n\t}\n\n\t/**\n\t * Get the size of the entire cache in bytes.\n\t *\n\t * @todo optional size of a given path if one is provided.\n\t * @return string\n\t */\n\tstatic size() {\n\t\treturn size();\n\t}\n\n\t/**\n\t * Get the count of roots in the cache.\n\t *\n\t * @return string\n\t */\n\tstatic count() {\n\t\treturn count();\n\t}\n\n\t/**\n\t * Determine if the given value matched the value at the given path in cache.\n\t *\n\t * @param path string\n\t * @param match mixed\n\t * @return bool\n\t */\n\tstatic equals(path, match) {\n\t\treturn equals(path, match);\n\t}\n}\n\nexport default Jim;\n","import getValue from './getValue.js';\n\nfunction has(path) {\n\treturn typeof getValue(path) !== 'undefined';\n}\n\nexport default has;\n","import driver from '../helpers/driver.js';\nimport setUpdatedAt from '../helpers/setUpdatedAt.js';\nimport dateFromDifferenceString from '../helpers/dateFromDifferenceString.js';\n\n\nfunction remember(path, value, expires_at) {\n\n\tif (typeof path === 'undefined') {\n\t\treturn false;\n \t}\n\n\n\tlet memory = driver();\n\tlet item = memory.roots[path] = {};\n\texpires_at = typeof expires_at === 'undefined' ?\n\t\twindow.__jimcares.defaultExpiration :\n\t\texpires_at;\n\n\n\titem.value = value;\n\titem.created_at = new Date();\n\titem.updated_at = new Date();\n\titem.deleted_at = null;\n\titem.expires_at = dateFromDifferenceString(expires_at);\n\tsetUpdatedAt();\n\treturn true;\n}\n\nexport default remember;\n","import toJson from './toJson.js';\n\nfunction writeToLS(path) {\n\tif (typeof(Storage) === \"undefined\") {\n\t\tconsole.error('Client does not support local storage');\n\t\treturn false;\n\t}\n\n\treturn localStorage.setItem(\"__jimcares\", toJson());\n}\n\nexport default writeToLS;\n","import driver from '../helpers/driver.js';\nimport getPathProps from '../helpers/getPathProps.js';\nimport setUpdatedAt from '../helpers/setUpdatedAt.js';\n\nfunction clear(path) {\n\tlet memory = driver();\n\tlet exclusions = [\"created_at\", \"updated_at\"]\n\tfor (let i in memory.roots) {\n\t\tdelete memory.roots[i]\n\t}\n}\n\nexport default clear;\n","function destroy(path) {\n\tclearInterval(window.__jimcares.expirationWorker);\n\treturn delete window.__jimcares;\n}\n\nexport default destroy;\n","import driver from '../helpers/driver.js';\n\nfunction count(path) {\n\tlet memory = driver();\n\treturn Object.keys(memory.roots).length;\n}\n\nexport default count;\n","import getValue from './getValue.js';\n\nfunction equals(path, match) {\n\treturn getValue(path) === match;\n}\n\nexport default equals;\n"],"names":["driver","window","__jimcares","Error","getPathProps","path","split","getValue","memory","pathProps","length","roots","value","node","index","shift","size","object","objects","Object","prototype","toString","call","key","processed","search","push","sizeof","getRoot","setUpdatedAt","updated_at","Date","trash","root","deleted_at","toJson","JSON","stringify","forget","dateFromDifferenceString","difference","date","interval","units","checkRollover","ret","getDate","setDate","toLowerCase","setFullYear","getFullYear","setMonth","getMonth","setTime","getTime","undefined","dateAdd","settings","defaultExpiration","created_at","expirationWorker","setInterval","i","expires_at","initialise","has","item","remember","Storage","console","error","localStorage","setItem","clear","clearInterval","keys","count","match","equals"],"mappings":"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"}